#include<stdio.h>
#include<unistd.h>
#include<errno.h>
int main(int argc,char*argv[]){
	if(argc<2){
		fprintf(stderr,"Bitte Datei mit angeben.\n");
		return 1;
	}
	FILE*delfile;
	//Oeffnen
	printf("Oeffne Datei\n");
	if((delfile=fopen(argv[1],"w"))==NULL){
		fprintf(stderr,"Kann die Datei '%s' nicht schreibend oeffnen (errno: '%d','%s')\n",argv[1],errno,strerror(errno));
		return 1;
	}
	//Testen
	printf("Test Datei\n");
	if(fprintf(delfile,"Hallo Welt\n")<0){
		//Fehler
		fprintf(stderr,"Fehler beim Schreiben in die Datei '%s' (errno: '%d' ; '%s')\n",argv[1],errno,strerror(errno));
		return 1;
	}
	//Flushen
	printf("Flushe Datei\n");
	if(fflush(delfile)!=0){
		//Fehler
		fprintf(stderr,"Fehler beim Uebertragen des Buffers auf die Festplatte (Flushen mit 'fflush()') der Datei '%s' (errno: '%d' ; '%s')\n",
					argv[1],errno,strerror(errno));
		return 1;
	}
	//Kurze Pause
	printf("5 Sekunden Pause\n");
	sleep(5);
	//Loeschen, dann freopen
	printf("Loesche Datei\n");
	if(unlink(argv[1])!=0){
		//Ginge auch remove()
		fprintf(stderr,"Kann die Datei '%s' nicht loeschen (errno: '%d','%s')\n",argv[1],errno,strerror(errno));
		return 1;
	}
	//Reopen
	printf("Oeffne Datei mit 'freopen'\n");
	if((delfile=freopen(argv[1],"w+",delfile))==NULL){
		fprintf(stderr,"Kann die Datei '%s' nicht lesend oeffnen (errno: '%d','%s')\n",argv[1],errno,strerror(errno));
		return 1;
	}
	//Schreiben testen
	printf("Schreibe in Datei\n");
	if(fprintf(delfile,"Tschau Welt\n")<0){
		//Fehler
		fprintf(stderr,"Fehler beim Schreiben in die Datei '%s' (errno: '%d' ; '%s')\n",argv[1],errno,strerror(errno));
		return 1;
	}
	//Flushen
	printf("Flushe Datei\n");
	if(fflush(delfile)!=0){
		//Fehler
		fprintf(stderr,"Fehler beim Uebertragen des Buffers auf die Festplatte (Flushen mit 'fflush()') der Datei '%s' (errno: '%d' ; '%s')\n",
					argv[1],errno,strerror(errno));
		return 1;
	}
	//Gehe zurueck an Anfang
	printf("Rewind()e Datei\n");
	rewind(delfile);
	//Lesen testen
	printf("Lese Datei\n");
	int c;
	while((c=getc(delfile))!=EOF)putc(c,stdout);
	//Schliessen
	printf("Schliesse Datei\n");
	if(fclose(delfile)==EOF){
		fprintf(stderr,"Kann die Datei '%s' nicht schliessen (errno: '%d','%s')\n",argv[1],errno,strerror(errno));
	}
	return 0;
}
